CREATE OR ALTER PROCEDURE CLIENT_MANAGER.CREATE_CLIENT
(
	@CLIENT_NAME VARCHAR(50),
	@CLIENT_SURNAME VARCHAR(50),
	@GENDER BIT,
	@CLIENT_ID INT OUTPUT
)
AS BEGIN

	INSERT INTO CLIENT_MANAGER.CLIENTS(CLIENT_SURNAME, CLIENT_NAME, GENDER)
	VALUES (@CLIENT_SURNAME, @CLIENT_NAME, @GENDER)

	SELECT @CLIENT_ID = SCOPE_IDENTITY();

END;
GO

CREATE OR ALTER PROCEDURE CLIENT_MANAGER.GET_USER_CLIENTS
(
	@USER_ID VARCHAR(50)
)
AS BEGIN
	SELECT
		C.ID,
		C.CLIENT_NAME,
		C.CLIENT_SURNAME,
		C.GENDER,
		CASE
			WHEN SUM(A.BALANCE) > 5000
		THEN 1 ELSE 0 END AS IS_VIP
	FROM CLIENT_MANAGER.CLIENTS AS C
	LEFT JOIN CLIENT_MANAGER.CLIENT_ACCOUNTS AS A
		ON C.ID = A.CLIENT_ID
	WHERE MANAGER_ID = @USER_ID
	GROUP BY C.ID,
		C.CLIENT_NAME,
		C.CLIENT_SURNAME,
		C.GENDER
END;